@import com.gu.i18n.CountryGroup
@import com.gu.memsub.Current
@import com.gu.salesforce.PaidTier
@import com.gu.salesforce.Tier.Supporter

@import views.support.PageInfo
@import views.model.Roundel
@import model.Highlights
@import model.PackagePromo.CtaButton
@import com.netaporter.uri.dsl._
@import com.gu.memsub.promo.PromoCode
@import com.gu.memsub.promo.Promotion._
@import com.gu.memsub.promo._
@import views.support.Asset
@import scalaz.Id._
@import views.support.HeroImageAlignment._

@import com.gu.memsub.promo.MembershipLandingPage
@import org.pegdown.PegDownProcessor
@import com.gu.memsub.subsv2.MonthYearPlans
@import com.gu.memsub.subsv2.CatalogPlan.PaidMember
@import views.support.MembershipCompat._

@(pricePlans: MonthYearPlans[PaidMember],
    pageInfo: PageInfo,
    headerImage: model.OrientatedImages,
    heroImageAlignment: HeroImageAlignment,
    promotionImage: com.gu.memsub.images.ResponsiveImageGroup,
    promoCode: PromoCode,
    promotion: Promotion[PromotionType[PromoContext], Id, MembershipLandingPage],
    pd: PegDownProcessor
)(implicit countryGroup: CountryGroup)


@main(pageInfo.title, pageInfo=pageInfo, countryGroup=Some(countryGroup)) {
    @fragments.promotions.roundel(promotion.landingPage.roundelHtml.map(pd.markdownToHtml), classModifier = Some("alt"))

    @fragments.page.heroBanner(headerImage, modifierClass = "hero-banner--alt-accent", imageModifierClass = heroImageAlignment.cssName) {
        @promotion.landingPage.title.getOrElse(promotion.name)
    } {
        @promotion.landingPage.subtitle.getOrElse("Support the independence of the Guardian and our award-winning journalism, plus enjoy a host of benefits")
    }()

    @fragments.page.section(hasBorder = false) {
        @fragments.tier.packagePromo(
            pricePlans,
            countryGroup,
            promoCode = Some(promoCode.get),
            modifierClass = Some("package-promo--clean"),
            secondaryButton = if (pricePlans.month.tier != Supporter()) Some(CtaButton("Find out more", "/", Map.empty)) else None
        )
    }

    @fragments.page.section("Introducing Guardian Members", isNarrow = false) {
        @fragments.listing.introducingMembers()
    }

    @fragments.page.sectionCardStack(promotionImage) {
        <div class="listing__text">
            <p>@Html(pd.markdownToHtml(promotion.landingPage.description.getOrElse(promotion.description)))</p>
            <p>
                <a class="action" href="@{routes.Joiner.enterPaidDetails(pricePlans.month.tier)}?countryGroup=@countryGroup.id">Become a @pricePlans.month.tier.name</a>
            </p>
        </div>
    }

    @fragments.page.section("If you read the Guardian, join the Guardian") {
        @fragments.promos.promoQuote(
            Asset.at("images/common/katharine-viner-cutout.png"),
            "Katharine Viner, editor-in-chief of the Guardian"
        ) {
            <blockquote class="blockquote">
                With Guardian Members we have a profound opportunity to
                defend the Guardianâ€™s independent journalism and collaborate
                together on a better, more informed future.
                <cite class="blockquote__citation">Katharine Viner, editor-in-chief of the Guardian</cite>
            </blockquote>
        }
    }

    @fragments.page.section("What's included") {
        @fragments.tier.packagePromo(
            pricePlans,
            countryGroup,
            promoCode = Some(promoCode.get),
            modifierClass = Some("package-promo--clean"),
            secondaryButton = if (pricePlans.month.tier != Supporter()) Some(CtaButton("Find out more", "/", Map.empty)) else None
        )
    }
}
